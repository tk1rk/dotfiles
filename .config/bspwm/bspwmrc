#!/usr/bin/env sh

# ##############################################################################
# #                                  ENV VARS                                  # 
# ##############################################################################

## Bspwm config directory
BSPDIR="${HOME}/.config/bspwm"

## Export bspwm/bin dir to PATH
export PATH="${PATH}:$HOME/.config/bspwm/bin"

## Java Applications
wmname LG3D
export _JAVA_AWT_WM_NONREPARENTING=1

# wallpapers
export WALLPAPER="${HOME}/.config/bspwm/wallpapers/bloodfountain.jpg"
export LOCKSCREEN_WALLPAPER="${HOME}/.config/bspwm/wallpapers/bloodfountain.jpg"

# Parse colors from "${HOME}/.Xresources"
xrdb -override "${HOME}/.Xresources"

# autostart
sh "${HOME}/.config/bspwm/bin/autostart.sh" &
# ##############################################################################
# #                                  FUNCTIONS                                 # 
# ##############################################################################
rule() { bspc rule -a "$@" & }
config() { bspc config "$@" & }
start() { pkill -x "$1"; { sleep 0.1; "$@" & }; }


# ##############################################################################
# #                                 WINDOW RULES                               #
# ##############################################################################
bspc monitor -d 1 2 3 4 


# ##############################################################################
# #                            GENERAL CONFIGURATION                           #
# ##############################################################################
config pointer_modifier          Mod4
config pointer_action1           move
config pointer_action2           resize_side
config pointer_action3           resize_corner

config top_padding               0
config left_padding              35
config right_padding             0
config bottom_padding            0

# Apply bspwm configurations
config border_width              "$CURRENT_BORDER"
config window_gap                "$CURRENT_GAP"
config split_ratio                  "$CURRENT_SRATIO"

config focused_border_color      "$BLUE" 
config normal_border_color       "$BACKGROUND"
config active_border_color       "$MAGENTA"
config presel_feedback_color     "$GREEN"

config borderless_monocle        true
config gapless_monocle           false
config paddingless_monocle       true
config single_monocle            true
config focus_follows_pointer     true
config center_pseudo_tiled       true

# Manage all the unmanaged windows remaining from a previous session.
bspc wm --adopt-orphans


# ##############################################################################
# #                                 THEME                                      #
# ##############################################################################
# Load current theme files to get colors for bspwm
source "$BSPDIR"/themes/dracula.sh

## Get the wallpaper from theme file
CURRENT_WALLPAPER="$wallpaper"

## Get the colors from theme file
FOREGROUND="$foreground"
BACKGROUND="$background"
CURSOR="$cursor"
BLACK="$color0"
RED="$color1"
GREEN="$color2"
YELLOW="$color3"
BLUE="$color4"
MAGENTA="$color5"
CYAN="$color6"
WHITE="$color7"
ALTBLACK="$color8"
ALTRED="$color9"
ALTGREEN="$color10"
ALTYELLOW="$color11"
ALTBLUE="$color12"
ALTMAGENTA="$color13"
ALTCYAN="$color14"
ALTWHITE="$color15"

## Bspwm appearance
CURRENT_BORDER='1'
CURRENT_GAP='10'
CURRENT_SRATIO='0.52'



##############################################################################
#                                 MISCELLANEOUS                              #
##############################################################################

###External rules
# Pseudo automatic mode: always splits focused ~window when opening new windowp
bspc config external_rules_command ~/.config/bspwm/scripts/pseudo_automatic_mode

# Adjust new window: splits biggest windows to keep windows about the same size
bspc config external_rules_command Â¹q~/.config/bspwm/scripts/adjust-new-window
