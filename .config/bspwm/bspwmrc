#!/usr/bin/env sh

# ##############################################################################
# #                                  ENV VARS                                  # 
# ##############################################################################

## Bspwm config directory
BSPDIR="$HOME/.config/bspwm"

## Export bspwm/bin dir to PATH
export PATH="${PATH}:$HOME/.config/bspwm/bin"

## Java Applications
wmname LG3D
export _JAVA_AWT_WM_NONREPARENTING=1

# wallpapers
export WALLPAPER="$HOME/.config/bspwm/wallpapers/bloodfountain.jpg"
export LOCKSCREEN_WALLPAPER="$HOME/.config/bspwm/wallpapers/bloodfountain.jpg"

# Parse colors from "~/.Xresources"
xrdb -override "${HOME}/.Xresources"


# ##############################################################################
# #                                  FUNCTIONS                                 # 
# ##############################################################################
rule() { bspc rule -a "$@" & }
config() { bspc config "$@" & }
start() { pkill -x "$1"; { sleep 0.1; "$@" & }; }


# ##############################################################################
# #                                 WINDOW RULES                               #
# ##############################################################################
bspc monitor -d 1 2 3 4 


# ##############################################################################
# #                            GENERAL CONFIGURATION                           #
# ##############################################################################
config pointer_modifier             Mod4


config top_padding                  0
config left_padding                 48
config right_padding                0
config bottom_padding               0

# Apply bspwm configurations
bspc config border_width "$CURRENT_BORDER"
bspc config window_gap "$CURRENT_GAP"
bspc config split_ratio "$CURRENT_SRATIO"

bspc config focused_border_color "$BLUE" 
bspc config normal_border_color "$BACKGROUND"
bspc config active_border_color "$MAGENTA"
bspc config presel_feedback_color "$GREEN"

config borderless_monocle           true
config gapless_monocle              true
bspc config paddingless_monocle     true
bspc config single_monocle          false
config focus_follows_pointer        true

# Manage all the unmanaged windows remaining from a previous session.
bspc wm --adopt-orphans


# ##############################################################################
# #                                 THEME                                      #
# ##############################################################################
# Load current theme files to get colors for bspwm
source "$BSPDIR"/themes/dracula.sh

## Get the wallpaper from theme file
CURRENT_WALLPAPER="$wallpaper"

## Get the colors from theme file
FOREGROUND="$foreground"
BACKGROUND="$background"
CURSOR="$cursor"
BLACK="$color0"
RED="$color1"
GREEN="$color2"
YELLOW="$color3"
BLUE="$color4"
MAGENTA="$color5"
CYAN="$color6"
WHITE="$color7"
ALTBLACK="$color8"
ALTRED="$color9"
ALTGREEN="$color10"
ALTYELLOW="$color11"
ALTBLUE="$color12"
ALTMAGENTA="$color13"
ALTCYAN="$color14"
ALTWHITE="$color15"

## Bspwm appearance
CURRENT_BORDER='1'
CURRENT_GAP='10'
CURRENT_SRATIO='0.52'



##############################################################################
#                                 MISCELLANEOUS                              #
##############################################################################

###External rules
# Pseudo automatic mode: always splits focused window when opening new window
bspc config external_rules_command ~/.config/bspwm/scripts/pseudo_automatic_mode

# Adjust new window: splits biggest windows to keep windows about the same size
bspc config external_rules_command ~/.config/bspwm/scripts/adjust-new-window
